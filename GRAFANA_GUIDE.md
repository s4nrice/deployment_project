# üìä –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ä–∞–±–æ—Ç–µ —Å Grafana

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –í—Ö–æ–¥ –≤ Grafana

1. –û—Ç–∫—Ä–æ–π—Ç–µ –±—Ä–∞—É–∑–µ—Ä –∏ –ø–µ—Ä–µ–π–¥–∏—Ç–µ –ø–æ –∞–¥—Ä–µ—Å—É: **http://localhost:3000**
2. –í–æ–π–¥–∏—Ç–µ —Å —É—á–µ—Ç–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏:
   - **Username**: `admin`
   - **Password**: `admin`
3. –ü—Ä–∏ –ø–µ—Ä–≤–æ–º –≤—Ö–æ–¥–µ Grafana –º–æ–∂–µ—Ç –ø–æ–ø—Ä–æ—Å–∏—Ç—å –∏–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å (–º–æ–∂–Ω–æ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å)

### 2. –ü–æ–∏—Å–∫ –¥–∞—à–±–æ—Ä–¥–∞

#### –°–ø–æ—Å–æ–± 1: –ß–µ—Ä–µ–∑ –º–µ–Ω—é Dashboards
1. –í –ª–µ–≤–æ–º –º–µ–Ω—é –Ω–∞–∂–º–∏—Ç–µ –Ω–∞ –∏–∫–æ–Ω–∫—É **"Dashboards"** (—á–µ—Ç—ã—Ä–µ –∫–≤–∞–¥—Ä–∞—Ç–∏–∫–∞) –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ `D` –Ω–∞ –∫–ª–∞–≤–∏–∞—Ç—É—Ä–µ
2. –í —Å–ø–∏—Å–∫–µ –¥–∞—à–±–æ—Ä–¥–æ–≤ –Ω–∞–π–¥–∏—Ç–µ **"FastAPI Observability"**
3. –ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ –Ω–µ–≥–æ –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è

#### –°–ø–æ—Å–æ–± 2: –ü—Ä—è–º–∞—è —Å—Å—ã–ª–∫–∞
–ü–µ—Ä–µ–π–¥–∏—Ç–µ –ø–æ –∞–¥—Ä–µ—Å—É: **http://localhost:3000/d/fastapi-observability/fastapi-observability**

#### –°–ø–æ—Å–æ–± 3: –ü–æ–∏—Å–∫
1. –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∏–∫–æ–Ω–∫—É –ø–æ–∏—Å–∫–∞ (–ª—É–ø–∞) –≤ –≤–µ—Ä—Ö–Ω–µ–º –º–µ–Ω—é
2. –í–≤–µ–¥–∏—Ç–µ `fastapi` –∏–ª–∏ `observability`
3. –í—ã–±–µ—Ä–∏—Ç–µ –Ω—É–∂–Ω—ã–π –¥–∞—à–±–æ—Ä–¥

### 3. –ß—Ç–æ –≤—ã —É–≤–∏–¥–∏—Ç–µ –≤ –¥–∞—à–±–æ—Ä–¥–µ

–î–∞—à–±–æ—Ä–¥ **FastAPI Observability** —Å–æ–¥–µ—Ä–∂–∏—Ç —Å–ª–µ–¥—É—é—â–∏–µ –≥—Ä–∞—Ñ–∏–∫–∏:

1. **HTTP Requests Rate** - –°–∫–æ—Ä–æ—Å—Ç—å HTTP –∑–∞–ø—Ä–æ—Å–æ–≤ (–∑–∞–ø—Ä–æ—Å–æ–≤ –≤ —Å–µ–∫—É–Ω–¥—É)
   - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –ø–æ –º–µ—Ç–æ–¥–∞–º, —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞–º –∏ —Å—Ç–∞—Ç—É—Å–∞–º

2. **HTTP Request Duration (p95)** - –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∑–∞–ø—Ä–æ—Å–æ–≤ (95-–π –ø–µ—Ä—Ü–µ–Ω—Ç–∏–ª—å)
   - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤—Ä–µ–º—è –æ—Ç–∫–ª–∏–∫–∞ API

3. **Active HTTP Requests** - –ê–∫—Ç–∏–≤–Ω—ã–µ HTTP –∑–∞–ø—Ä–æ—Å—ã
   - –¢–µ–∫—É—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

4. **Cache Hits/Misses** - –ü–æ–ø–∞–¥–∞–Ω–∏—è –∏ –ø—Ä–æ–º–∞—Ö–∏ –∫—ç—à–∞
   - –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –≤ Redis

5. **Rate Limit Hits** - –°—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏—è rate limit
   - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

6. **Redis Connection Status** - –°—Ç–∞—Ç—É—Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Redis
   - –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —Å–æ—Å—Ç–æ—è–Ω–∏—è Redis (1 = –ø–æ–¥–∫–ª—é—á–µ–Ω, 0 = –æ—Ç–∫–ª—é—á–µ–Ω)

## üìà –°–æ–∑–¥–∞–Ω–∏–µ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã—Ö –≥—Ä–∞—Ñ–∏–∫–æ–≤

### –®–∞–≥ 1: –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –¥–∞—à–±–æ—Ä–¥

1. –ù–∞–∂–º–∏—Ç–µ **"+"** –≤ –ª–µ–≤–æ–º –º–µ–Ω—é ‚Üí **"Create"** ‚Üí **"Dashboard"**
2. –ò–ª–∏ –Ω–∞–∂–º–∏—Ç–µ **"New"** ‚Üí **"Dashboard"** –≤ –º–µ–Ω—é Dashboards

### –®–∞–≥ 2: –î–æ–±–∞–≤–∏—Ç—å –ø–∞–Ω–µ–ª—å (–≥—Ä–∞—Ñ–∏–∫)

1. –ù–∞–∂–º–∏—Ç–µ **"Add visualization"** –∏–ª–∏ **"Add panel"**
2. –í—ã–±–µ—Ä–∏—Ç–µ –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö **"Prometheus"** (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)

### –®–∞–≥ 3: –ù–∞–ø–∏—Å–∞—Ç—å –∑–∞–ø—Ä–æ—Å (Query)

–í –ø–æ–ª–µ –∑–∞–ø—Ä–æ—Å–∞ –≤–≤–µ–¥–∏—Ç–µ PromQL –∑–∞–ø—Ä–æ—Å. –ü—Ä–∏–º–µ—Ä—ã:

#### –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ HTTP –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ —Å–µ–∫—É–Ω–¥—É:
```promql
sum(rate(http_requests_total[5m])) by (method, endpoint, status)
```

#### –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∑–∞–ø—Ä–æ—Å–æ–≤ (p95):
```promql
histogram_quantile(0.95, sum(rate(http_request_duration_seconds_bucket[5m])) by (le, method, endpoint))
```

#### –ê–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã:
```promql
http_active_requests
```

#### –ü–æ–ø–∞–¥–∞–Ω–∏—è –≤ –∫—ç—à:
```promql
sum(rate(cache_hits_total[5m])) by (cache_type)
```

#### –ü—Ä–æ–º–∞—Ö–∏ –∫—ç—à–∞:
```promql
sum(rate(cache_misses_total[5m])) by (cache_type)
```

#### –°—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏—è rate limit:
```promql
sum(rate(rate_limit_hits_total[5m]))
```

#### –°—Ç–∞—Ç—É—Å Redis:
```promql
redis_connection_status
```

### –®–∞–≥ 4: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—é

1. –í –ø—Ä–∞–≤–æ–π –ø–∞–Ω–µ–ª–∏ –≤—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏:
   - **Time series** - –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–æ–≤ –≤–æ –≤—Ä–µ–º–µ–Ω–∏
   - **Stat** - –¥–ª—è –æ–¥–∏–Ω–æ—á–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π
   - **Gauge** - –¥–ª—è –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤
   - **Bar chart** - –¥–ª—è —Å—Ç–æ–ª–±—á–∞—Ç—ã—Ö –¥–∏–∞–≥—Ä–∞–º–º

2. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∑–∞–≥–æ–ª–æ–≤–æ–∫, –µ–¥–∏–Ω–∏—Ü—ã –∏–∑–º–µ—Ä–µ–Ω–∏—è, —Ü–≤–µ—Ç–∞ –∏ —Ç.–¥.

3. –ù–∞–∂–º–∏—Ç–µ **"Apply"** –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è

### –®–∞–≥ 5: –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –¥–∞—à–±–æ—Ä–¥

1. –ù–∞–∂–º–∏—Ç–µ **"Save dashboard"** (–¥–∏—Å–∫–µ—Ç–∞) –≤ –ø—Ä–∞–≤–æ–º –≤–µ—Ä—Ö–Ω–µ–º —É–≥–ª—É
2. –í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –¥–∞—à–±–æ—Ä–¥–∞
3. –í—ã–±–µ—Ä–∏—Ç–µ –ø–∞–ø–∫—É (–∏–ª–∏ –æ—Å—Ç–∞–≤—å—Ç–µ "General")
4. –ù–∞–∂–º–∏—Ç–µ **"Save"**

## üîç –ü–æ–ª–µ–∑–Ω—ã–µ PromQL –∑–∞–ø—Ä–æ—Å—ã

### –¢–æ–ø —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤ –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –∑–∞–ø—Ä–æ—Å–æ–≤:
```promql
topk(10, sum(rate(http_requests_total[5m])) by (endpoint))
```

### –û—à–∏–±–∫–∏ (—Å—Ç–∞—Ç—É—Å 4xx –∏ 5xx):
```promql
sum(rate(http_requests_total{status=~"4..|5.."}[5m])) by (status, endpoint)
```

### –ü—Ä–æ—Ü–µ–Ω—Ç –ø–æ–ø–∞–¥–∞–Ω–∏–π –≤ –∫—ç—à:
```promql
sum(rate(cache_hits_total[5m])) / (sum(rate(cache_hits_total[5m])) + sum(rate(cache_misses_total[5m]))) * 100
```

### –°—Ä–µ–¥–Ω—è—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∑–∞–ø—Ä–æ—Å–æ–≤:
```promql
sum(rate(http_request_duration_seconds_sum[5m])) / sum(rate(http_request_duration_seconds_count[5m]))
```

## üõ† –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –¥–∞–Ω–Ω—ã—Ö

–ï—Å–ª–∏ Prometheus –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω:

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Configuration** (—à–µ—Å—Ç–µ—Ä–µ–Ω–∫–∞) ‚Üí **Data sources**
2. –ù–∞–∂–º–∏—Ç–µ **"Add data source"**
3. –í—ã–±–µ—Ä–∏—Ç–µ **"Prometheus"**
4. –í –ø–æ–ª–µ **URL** –≤–≤–µ–¥–∏—Ç–µ: `http://prometheus:9090`
5. –ù–∞–∂–º–∏—Ç–µ **"Save & Test"**

## üìù –ü–æ–ª–µ–∑–Ω—ã–µ —Å–æ–≤–µ—Ç—ã

- **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö**: –í –ø—Ä–∞–≤–æ–º –≤–µ—Ä—Ö–Ω–µ–º —É–≥–ª—É –º–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å –∏–Ω—Ç–µ—Ä–≤–∞–ª –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥)
- **–í—Ä–µ–º–µ–Ω–Ω–æ–π –¥–∏–∞–ø–∞–∑–æ–Ω**: –í—ã–±–µ—Ä–∏—Ç–µ –ø–µ—Ä–∏–æ–¥ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 15 –º–∏–Ω—É—Ç, 1 —á–∞—Å, 6 —á–∞—Å–æ–≤ –∏ —Ç.–¥.)
- **–≠–∫—Å–ø–æ—Ä—Ç**: –î–∞—à–±–æ—Ä–¥—ã –º–æ–∂–Ω–æ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ JSON –¥–ª—è —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è
- **–ê–ª–µ—Ä—Ç—ã**: –ú–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö –º–µ—Ç—Ä–∏–∫

## üêõ –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –ì—Ä–∞—Ñ–∏–∫–∏ –ø—É—Å—Ç—ã–µ –∏–ª–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç "No data"
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ Prometheus —Å–æ–±–∏—Ä–∞–µ—Ç –º–µ—Ç—Ä–∏–∫–∏: http://localhost:9090
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç –º–µ—Ç—Ä–∏–∫–∏: http://localhost:8888/metrics
3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Ä–µ–º–µ–Ω–Ω–æ–π –¥–∏–∞–ø–∞–∑–æ–Ω –≤—ã–±—Ä–∞–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ

### –î–∞—à–±–æ—Ä–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Grafana: `docker-compose logs grafana`
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ñ–∞–π–ª –¥–∞—à–±–æ—Ä–¥–∞ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ `monitoring/grafana/dashboards/`
3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ Grafana: `docker-compose restart grafana`

### –ò—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ Prometheus –∑–∞–ø—É—â–µ–Ω: `docker-compose ps prometheus`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å Prometheus –∏–∑ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ Grafana
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ `monitoring/grafana/provisioning/datasources/prometheus.yml`

